
<div ng-if="section['objects_count']['by_positions'][layout.name].count &gt; 0 || layout.include_even_empty" ng-repeat="layout in available_layouts">
  <div class="layout_ layout_name_{{layout.name}} has_count_{{section.objects_count.by_positions[layout.name].count}} has_object_{{section.objects_count.by_positions[layout.name].has_object}}">
    <!-- title, author, date, ..-->
    <doc-title ng-if="(layout.include_title) &amp;&amp; ($parent.$parent.$first) &amp;&amp;  (ui.renderAvailable_active !=='embed') "></doc-title>
    <mb-dataset ng-if="ui.dataset.active &amp;&amp; (layout.include_dataset)"></mb-dataset>
    <!--  -->
    <div ng-if="layout.name == 'right'">
      <!-- h1 {{section.selected}}-->
      <!-- h2 {{ui.selected_range.working_section}}-->
      <!-- pre {{section.cursor_in}}-->
      <!-- edit/delete range and css objects.-->
      <mb-sectioneditor ng-if="doc_owner == true" class="section_editor section-editor-right"></mb-sectioneditor>
      <!-- made to boot controller, not displayed here-->
      <div ng-repeat="markup in markups_by_start_end_position_type(section.start, section.end ,'background', 'media') track by $index" class="markup_ markup_type_bg">
        <markup-view></markup-view>
      </div>
      <div ng-controller="MarkupCtrl" style="display:none" ng-repeat="markup in markups_by_start_end_position_type(section.start, section.end ,'any', 'container_class') track by $index"></div>
      <div ng-controller="MarkupCtrl" style="display:none" ng-repeat="markup in markups_by_start_end_position_type(section.start, section.end ,'inline', 'markup') track by $index"></div>
    </div>
    <div ng-if="object.visible!==false &amp;&amp; layout.include_objects!==false &amp;&amp; layout.name!=='slidewide'" ng-repeat="object in available_sections_objects">
      <!--h3 {{object}} -->
      <div ng-repeat="markup in markups_by_start_end_position_type(section.start, section.end ,layout.name,object) track by $index">
        <div class="markup_ markup_type_{{markup.type}}">
          <markup-view></markup-view>
        </div>
      </div>
    </div>
    <!-- old mb-commentform(ng-if="(doc_options.comments_open.value !=='false' || !doc_options.comments_open.value  ) && layout.name == 'left'")-->
    <mb-pusher type="column" position="{{layout.name}}" ng-if="(doc_options.comments_open.value !=='false' || !doc_options.comments_open.value  ) &amp;&amp; layout.name == 'left'"></mb-pusher>
    <div ng-if="layout.name == 'slidewide'">
      <carousel interval="1000">
        <slide ng-repeat="markup in markups_by_start_end_position_type(section.start, section.end ,'slidewide','media') track by $index">
          <p> <img ng-src="{{markup.metadata}}"/></p>
        </slide>
      </carousel>
    </div>
    <div ng-if="layout.name == 'inline'">
      <!-- pre {{ui.current_action}}-->
      <!-- pre {{ui.selected_range}}-->
      <!-- h3 {{section.rebuild_count}}-->
      <!-- pre(ng-repeat="md in markups_pushed") {{md.start}} {{md.end}} {{md.metadata}} {{md}}-->
      <!-- h2 
      a(ng-click="sectionmarkups('selected', true)") {{section_markups.visible}}
      
      -->
      <mb-sectioninlineeditor></mb-sectioninlineeditor>
      <div ng-if="section.editing_text === true" class="fluidtextarea">
        <!-- h3 Edit section text-->
        <textarea required="required" ng-trim="false" text-listener="text-listener" ng-model="section.fulltext"></textarea>
        <!--div.mtextarea(contentEditable="true" , required ng-trim="false" , text-listener  , ng-bind-html="section.fulltext")-->
        
        
      </div>
      <!-- h1 editable-->
      <!-- div.fluidtext(contentEditable="true" , mb-editable , section="section" , ng-bind-html="section.fulltext" ) -->
      <div section="section" ng-if="section.modeletters == 'single'" class="theletters is_multi_{{ui.selected_range.multi}} boundaries_end_{{ui.boundaries.endAtEnd}}"><span lt="l" ng-repeat="l in section.letters"></span></div>
      <div fluidtexte="fluidtexte" section="section" ng-hide="section.modeletters =='single'" class="fluidtext"> </div>
      <!-- div.fluidtddext {{section.fulltext_block}}-->
      
      <mb-pusher type="new_section" position="{{layout.name}}"></mb-pusher>
    </div>
    <div ng-if="layout.name == 'global' &amp;&amp; $parent.$parent.$last">
      <!-- h4 {{layout.name}}-->
      <div ng-repeat="object in available_sections_objects track by $index">
        <div ng-repeat="markup in markups_by_start_end_position_type(0, section.end , layout.name, object) track by $index">
          <div class="markup_ markup_type_{{markup.type}}">
            <markup-view></markup-view>
          </div>
        </div>
      </div>
    </div>
    <!-- div.isolated(ng-if="layout.name == 'global' && $parent.$parent.$last &&  ui.isolated_markups.length > 0" )
    h4 isolated
    div(ng-repeat="markup in ui.isolated_markups")
    	markup-view()
    
    -->
    <!-- div.virtuals(ng-if="layout.name == 'global' && $parent.$parent.$last  > 0 " )
    div(ng-repeat="virtual in virtuals")
    	div(ng-if="virtual.visible", ng-bind-html="virtual.string")
    
    -->
  </div>
</div>
<!-- render into the layout loop, only "if last"-->
<!-- made to apply last section styles to footer-->
<footer ng-if="$last &amp;&amp; ui.renderAvailable_active !=='embed'">
  <p ng-bind-html="doc_options.footer_center_html.value"></p>
</footer>